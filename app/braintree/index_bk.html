<!doctype html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>test</title>
    <script src="../js/jquery-2.1.3.min.js"></script>

</head>
<body>

<!--test用カード番号
4000111111111115
07/15
-->

<p>test番号
4000111111111115</p>

<input type="text" value="" id="activityTest">

<form id="checkout" method="post" action="/api/users/1/purchases?sec=12345">
    <div id="payment-form"></div>
    <input type="hidden" name="activity_point" value="" id="inputActivityPoint">
    <input type="buttn" value="Pay $10" id="submitBtn">
</form>

<script src="https://js.braintreegateway.com/v2/braintree.js"></script>
<script>
    // We generated a client token for you so you can copy and paste this code
    // and try it out right away. See the section below to generate your
    // own client token.



    $(function(){

        var clientToken;
        var clientNounce;

        $.ajax({
            url: "https://koenjin.herokuapp.com/api/users/1/token",
            //url: "http://192.168.1.27:9000/api/users/1/token",
            type: "GET",
            success: function (data, textStatus, jqXHR) {

                //var clientToken = "eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiJmOWY5MmRlYTMyNTU0YWI4NmUzOGM5Mzc4MmYxMzY3NGFlOGIzZWNkYjZmMmI5NmE1ZjMxY2RlZDAxYTNkZmQwfGNyZWF0ZWRfYXQ9MjAxNS0wNi0xM1QxNToyNDoyMS43MzM0NTI2NDArMDAwMFx1MDAyNmN1c3RvbWVyX2lkPVx1MDAyNm1lcmNoYW50X2lkPXA3NTV4aG5keTlreTNkcXRcdTAwMjZwdWJsaWNfa2V5PXZ5YzZmejZuMnczc3RreWIiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvcDc1NXhobmR5OWt5M2RxdC9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbXSwiZW52aXJvbm1lbnQiOiJzYW5kYm94IiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzL3A3NTV4aG5keTlreTNkcXQvY2xpZW50X2FwaSIsImFzc2V0c1VybCI6Imh0dHBzOi8vYXNzZXRzLmJyYWludHJlZWdhdGV3YXkuY29tIiwiYXV0aFVybCI6Imh0dHBzOi8vYXV0aC52ZW5tby5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIn0sInRocmVlRFNlY3VyZUVuYWJsZWQiOnRydWUsInRocmVlRFNlY3VyZSI6eyJsb29rdXBVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvcDc1NXhobmR5OWt5M2RxdC90aHJlZV9kX3NlY3VyZS9sb29rdXAifSwicGF5cGFsRW5hYmxlZCI6dHJ1ZSwicGF5cGFsIjp7ImRpc3BsYXlOYW1lIjoiVGhyZWVlcyIsImNsaWVudElkIjpudWxsLCJwcml2YWN5VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3BwIiwidXNlckFncmVlbWVudFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbS90b3MiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOnRydWUsImVudmlyb25tZW50Tm9OZXR3b3JrIjp0cnVlLCJlbnZpcm9ubWVudCI6Im9mZmxpbmUiLCJ1bnZldHRlZE1lcmNoYW50IjpmYWxzZSwiYnJhaW50cmVlQ2xpZW50SWQiOiJtYXN0ZXJjbGllbnQzIiwibWVyY2hhbnRBY2NvdW50SWQiOiJ0OXh4ZHY3ZHdndmh2enJkIiwiY3VycmVuY3lJc29Db2RlIjoiVVNEIn0sImNvaW5iYXNlRW5hYmxlZCI6ZmFsc2UsIm1lcmNoYW50SWQiOiJwNzU1eGhuZHk5a3kzZHF0IiwidmVubW8iOiJvZmYifQ==";
                clientToken = data;

                braintree.setup(clientToken, "dropin", {
                    container: "payment-form"
                }, function(nounce){
                    clientNounce = nounce;
                });

                console.log(data);
                console.log(textStatus);
                console.log("success");
            },
            error: function (jqXHR, textStatus, errorThrown) {
                console.log("err");

                //TOOD .....
                var clientToken = "eyJ2ZXJzaW9uIjoyLCJhdXRob3JpemF0aW9uRmluZ2VycHJpbnQiOiJmOWY5MmRlYTMyNTU0YWI4NmUzOGM5Mzc4MmYxMzY3NGFlOGIzZWNkYjZmMmI5NmE1ZjMxY2RlZDAxYTNkZmQwfGNyZWF0ZWRfYXQ9MjAxNS0wNi0xM1QxNToyNDoyMS43MzM0NTI2NDArMDAwMFx1MDAyNmN1c3RvbWVyX2lkPVx1MDAyNm1lcmNoYW50X2lkPXA3NTV4aG5keTlreTNkcXRcdTAwMjZwdWJsaWNfa2V5PXZ5YzZmejZuMnczc3RreWIiLCJjb25maWdVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvcDc1NXhobmR5OWt5M2RxdC9jbGllbnRfYXBpL3YxL2NvbmZpZ3VyYXRpb24iLCJjaGFsbGVuZ2VzIjpbXSwiZW52aXJvbm1lbnQiOiJzYW5kYm94IiwiY2xpZW50QXBpVXJsIjoiaHR0cHM6Ly9hcGkuc2FuZGJveC5icmFpbnRyZWVnYXRld2F5LmNvbTo0NDMvbWVyY2hhbnRzL3A3NTV4aG5keTlreTNkcXQvY2xpZW50X2FwaSIsImFzc2V0c1VybCI6Imh0dHBzOi8vYXNzZXRzLmJyYWludHJlZWdhdGV3YXkuY29tIiwiYXV0aFVybCI6Imh0dHBzOi8vYXV0aC52ZW5tby5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIiwiYW5hbHl0aWNzIjp7InVybCI6Imh0dHBzOi8vY2xpZW50LWFuYWx5dGljcy5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tIn0sInRocmVlRFNlY3VyZUVuYWJsZWQiOnRydWUsInRocmVlRFNlY3VyZSI6eyJsb29rdXBVcmwiOiJodHRwczovL2FwaS5zYW5kYm94LmJyYWludHJlZWdhdGV3YXkuY29tOjQ0My9tZXJjaGFudHMvcDc1NXhobmR5OWt5M2RxdC90aHJlZV9kX3NlY3VyZS9sb29rdXAifSwicGF5cGFsRW5hYmxlZCI6dHJ1ZSwicGF5cGFsIjp7ImRpc3BsYXlOYW1lIjoiVGhyZWVlcyIsImNsaWVudElkIjpudWxsLCJwcml2YWN5VXJsIjoiaHR0cDovL2V4YW1wbGUuY29tL3BwIiwidXNlckFncmVlbWVudFVybCI6Imh0dHA6Ly9leGFtcGxlLmNvbS90b3MiLCJiYXNlVXJsIjoiaHR0cHM6Ly9hc3NldHMuYnJhaW50cmVlZ2F0ZXdheS5jb20iLCJhc3NldHNVcmwiOiJodHRwczovL2NoZWNrb3V0LnBheXBhbC5jb20iLCJkaXJlY3RCYXNlVXJsIjpudWxsLCJhbGxvd0h0dHAiOnRydWUsImVudmlyb25tZW50Tm9OZXR3b3JrIjp0cnVlLCJlbnZpcm9ubWVudCI6Im9mZmxpbmUiLCJ1bnZldHRlZE1lcmNoYW50IjpmYWxzZSwiYnJhaW50cmVlQ2xpZW50SWQiOiJtYXN0ZXJjbGllbnQzIiwibWVyY2hhbnRBY2NvdW50SWQiOiJ0OXh4ZHY3ZHdndmh2enJkIiwiY3VycmVuY3lJc29Db2RlIjoiVVNEIn0sImNvaW5iYXNlRW5hYmxlZCI6ZmFsc2UsIm1lcmNoYW50SWQiOiJwNzU1eGhuZHk5a3kzZHF0IiwidmVubW8iOiJvZmYifQ==";
                braintree.setup(clientToken, "dropin", {
                    container: "payment-form"
                });
            }
        });

        $('#submitBtn').click(function(){
            $.ajax({
                url: "/api/users/1/purchases",
                type: "POST",
                data: clientNounce,
                success: function (data, textStatus, jqXHR) {
                    console.log(data);
                    console.log(textStatus);
                    console.log("success");
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log("err");
                }
            });
        });

        $('#activityTest').on( "change", function(){
            $('#inputActivityPoint').val($('#activityTest').val());
        });

    });

</script>

</body>
</html>